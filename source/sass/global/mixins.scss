// =============================================================================
// MIXINS
// Mobile-First approach: base styles for mobile (320px+)
// =============================================================================

// -----------------------------------------------------------------------------
// Media Queries (Responsive Breakpoints)
// -----------------------------------------------------------------------------

// Tablet and up (768px+)
// Used for styles that apply to tablet and desktop
@mixin tablet {
  @media (min-width: $tablet-min) {
    @content;
  }
}

// Desktop and up (1440px+)
// Used for styles that apply only to desktop
@mixin desktop {
  @media (min-width: $desktop-min) {
    @content;
  }
}

// -----------------------------------------------------------------------------
// Overflow Prevention (HTML1-TEST-04)
// -----------------------------------------------------------------------------

// Prevents flex children from overflowing container
// Use on flex containers to add min-width: 0 to all direct children
// HTML1-TEST-04: Prevent flex children from overflowing container
@mixin flex-no-overflow {
  > * {
    min-width: 0;
  }
}

// Prevents grid children from overflowing container
// Use on grid containers to add min-width: 0 to all direct children
// HTML1-TEST-04: Prevent grid children from overflowing container
@mixin grid-no-overflow {
  > * {
    min-width: 0;
  }
}

// -----------------------------------------------------------------------------
// Responsive Line Break Visibility
// -----------------------------------------------------------------------------
// Manage visibility of <br> elements on different breakpoints

// Show <br> only on mobile (hide on tablet+)
@mixin br-mobile {
  display: block;

  @include tablet {
    display: none;
  }
}

// Show <br> only on tablet (hide on mobile and desktop)
@mixin br-tablet {
  display: none;

  @include tablet {
    display: block;
  }

  @include desktop {
    display: none;
  }
}

// Show <br> only on desktop
@mixin br-desktop {
  display: none;

  @include desktop {
    display: block;
  }
}

// Show <br> on tablet+ (hide on mobile)
@mixin br-not-mobile {
  display: none;

  @include tablet {
    display: block;
  }
}

// Show <br> on mobile and tablet (hide on desktop)
@mixin br-not-desktop {
  display: block;

  @include desktop {
    display: none;
  }
}

// -----------------------------------------------------------------------------
// Responsive Text Wrapping
// -----------------------------------------------------------------------------
// Manage white-space on different breakpoints

// Nowrap на tablet, normal на mobile/desktop
@mixin nowrap-tablet {
  white-space: normal;

  @include tablet {
    white-space: nowrap;
  }

  @include desktop {
    white-space: normal;
  }
}

// Nowrap on desktop
@mixin nowrap-desktop {
  @include desktop {
    white-space: nowrap;
  }
}

// Nowrap on mobile
@mixin nowrap-mobile {
  white-space: nowrap;

  @include tablet {
    white-space: normal;
  }
}

// -----------------------------------------------------------------------------
// Responsive Visibility
// -----------------------------------------------------------------------------
// Manage display on different breakpoints

// Hide on mobile
@mixin hide-mobile {
  display: none;

  @include tablet {
    display: block;
  }
}

// Hide on tablet
@mixin hide-tablet {
  display: block;

  @include tablet {
    display: none;
  }

  @include desktop {
    display: block;
  }
}

// Hide on desktop
@mixin hide-desktop {
  display: block;

  @include desktop {
    display: none;
  }
}

// -----------------------------------------------------------------------------
// Overlay Pattern (for modals and menus)
// -----------------------------------------------------------------------------

// Full-screen overlay with dark background
// Used for modal windows and navigation menu
@mixin overlay {
  position: fixed;
  inset: 0;
  background-color: $color-overlay-menu;
  z-index: $z-index-overlay;
}

// -----------------------------------------------------------------------------
// Slide-in Animations
// -----------------------------------------------------------------------------

// Slide in from right (for navigation menu)
// Element slides in from right side of screen
// Note: Apply .is-open class to trigger the slide-in animation
@mixin slide-in-right {
  transform: translateX(100%);
  transition: transform $transition-normal;
}


// -----------------------------------------------------------------------------
// Slider Scrollbar (Progress Bar)
// -----------------------------------------------------------------------------
// Base styles for progress bar in sliders
// Usage: apply to .block__slider-scrollbar or .swiper-scrollbar
@mixin slider-scrollbar {
  position: relative;
  width: 100%;
  height: 2px;
  background-color: rgba($border-color-scrollbar, 0.2);

  // Draggable element (active part of progress bar)
  .swiper-scrollbar-drag {
    position: absolute;
    top: 0;
    left: 0;
    height: 100%;
    background-color: $border-color-scrollbar;
    cursor: grab;

    &:active {
      cursor: grabbing;
    }
  }
}


// -----------------------------------------------------------------------------
// Form Elements (for forms and modals)
// -----------------------------------------------------------------------------
// Base styles for form controls to avoid duplication
// Used in: .form__ (form section), .modal__ (feedback modal), .notification-modal__ (email confirmation)

// Input Base Styles
// -----------------------------------------------------------------------------
// Base styles for text inputs (white background variant)
// Usage: apply to .form__input, .modal__input, .notification-modal__input
// Note: For blue background inputs, override colors in block styles
@mixin input-base {
  width: 100%;
  min-height: $input-height; // 76px
  padding: 20px 16px;
  border: 2px dashed rgba($color-form-disabled, 0.5);
  border-radius: $radius-input; // 8px
  background-color: $color-bg-secondary; // white
  font-family: $font-family;
  font-size: $font-size-text-regular; // 16px
  line-height: $line-height-text-regular; // 26px
  color: $color-form-on-light; // #484848
  transition: border-color $transition-normal, border-style $transition-normal;

  &::placeholder {
    color: $color-form-disabled;
    opacity: $opacity-label; // 0.8
  }

  // Hover state
  &:hover {
    border-style: solid;
    border-color: $color-form-on-light;
  }

  // Focus state
  &:focus {
    border-style: solid;
    border-color: $color-primary-blue;
    outline: none;
  }

  // Disabled state
  &:disabled {
    background-color: rgba($color-form-disabled, 0.2);
    color: $color-form-disabled;
    border-color: $color-form-disabled;
    cursor: not-allowed;
    opacity: $opacity-disabled; // 0.3
  }

  // Error state (add via .is-invalid or &--error)
  &.is-invalid,
  &--error {
    background-color: rgba($color-form-error, 0.1);
    border-style: solid;
    border-color: $color-form-error;

    // Keep error styling on focus
    &:focus {
      border-color: $color-form-error;
    }
  }
}

// Select Base Styles
// -----------------------------------------------------------------------------
// Base styles for select dropdowns (white background variant)
// Usage: apply to .form__select, .modal__select, .notification-modal__select
// Note: For blue background selects, override colors in block styles
// Note: Custom arrow icon should be added in block styles via background-image or ::after
@mixin select-base {
  width: 100%;
  min-height: $input-height; // 76px
  padding: 20px 40px 20px 16px; // Extra right padding for arrow
  border: 2px dashed rgba($color-form-disabled, 0.5);
  border-radius: $radius-input; // 8px
  background-color: $color-bg-secondary; // white
  font-family: $font-family;
  font-size: $font-size-text-regular; // 16px
  line-height: $line-height-text-regular; // 26px
  color: $color-form-on-light; // #484848
  cursor: pointer;
  transition: border-color $transition-normal, border-style $transition-normal;

  // Remove native dropdown arrow
  appearance: none;

  // Placeholder-like state (first empty option)
  &:invalid,
  &[value=""] {
    color: $color-form-disabled;
    opacity: $opacity-label; // 0.8
  }

  // Hover state
  &:hover {
    border-style: solid;
    border-color: $color-form-on-light;
  }

  // Focus state (when dropdown is open)
  &:focus {
    border-style: solid;
    border-color: $color-primary-blue;
    outline: none;
  }

  // Disabled state
  &:disabled {
    background-color: rgba($color-form-disabled, 0.2);
    color: $color-form-disabled;
    border-color: $color-form-disabled;
    cursor: not-allowed;
    opacity: $opacity-disabled; // 0.3
  }

  // Error state
  &.is-invalid,
  &--error {
    border-style: solid;
    border-color: $color-form-error;

    &:focus {
      border-color: $color-form-error;
    }
  }
}

// Checkbox Base Styles
// -----------------------------------------------------------------------------
// Base styles for custom checkboxes
//
// Миксин применяется к <label>, который идёт ПОСЛЕ скрытого <input type="checkbox">
//
// HTML структура (как в проекте):
//   <input class="form__checkbox visually-hidden" type="checkbox" id="check1">
//   <label class="form__checkbox-label" for="check1">Текст согласия</label>
//
// Как это работает:
// 1. Input скрыт через .visually-hidden (невидим, но доступен для a11y)
// 2. Label — это видимый чекбокс (::before = квадрат, ::after = галочка)
// 3. CSS селектор input:checked + label стилизует label когда input отмечен
// 4. Связь через for="check1" — клик по label активирует input
@mixin checkbox-base {
  position: relative;
  display: inline-flex;
  align-items: center;
  padding-left: 30px; // Space for checkbox box (20px + 10px gap)
  cursor: pointer;
  user-select: none;

  // Custom checkbox box (квадрат чекбокса)
  &::before {
    content: "";
    position: absolute;
    left: 0;
    top: 50%;
    transform: translateY(-50%);
    width: $checkbox-size; // 20px
    height: $checkbox-size; // 20px
    border: 2px solid $color-bg-secondary;;
    border-radius: 2px;
    background-color: $color-bg-secondary;
    transition: background-color $transition-normal, border-color $transition-normal;
  }

  // Custom checkmark (icon from check.svg)
  // Uses mask-image to display the SVG icon with the ability to change the color
  &::after {
    content: "";
    position: absolute;
    left: 2px; // Centered in 20px box
    top: 50%;
    transform: translateY(-50%);
    width: 16px;
    height: 14px;
    background-color: $color-bg-secondary; // white checkmark
    mask-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='21' height='19' fill='none' viewBox='0 0 21 19'%3E%3Cpath stroke='%23fff' stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='m.5 8 7.368 10.5L20.5.5'/%3E%3C/svg%3E");
    mask-size: contain;
    mask-repeat: no-repeat;
    mask-position: center;
    opacity: 0; // Hidden by default
    transition: opacity $transition-fast;
  }

  // Checked state - blue background + visible checkmark
  input[type="checkbox"]:checked + &::before {
    background-color: $color-primary-blue;
    border-color: $color-primary-blue;
  }

  input[type="checkbox"]:checked + &::after {
    opacity: 1; // Show checkmark
  }

  // Hover state
  &:hover::before {
    border-color: rgba($color-primary-blue, 0.8);
  }

  // Focus state
  input[type="checkbox"]:focus + &::before {
    outline: 2px solid rgba($color-primary-blue, 0.3);
    outline-offset: 2px;
  }

  // Disabled state
  input[type="checkbox"]:disabled + & {
    cursor: not-allowed;
    opacity: $opacity-disabled; // 0.3

    &::before {
      background-color: rgba($color-form-disabled, 0.2);
      border-color: $color-form-disabled;
    }
  }
}
